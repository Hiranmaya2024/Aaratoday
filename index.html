<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aaradhya Today</title>

<style>
body{margin:0;font-family:system-ui;background:#eef2f7;}
.app{max-width:1400px;margin:auto;}

.routeCard{
background:#fff;margin:14px;padding:18px;border-radius:22px;
box-shadow:0 6px 18px rgba(0,0,0,0.08);
}

.mapPreview{
width:100%;
height:220px;
border-radius:14px;
margin-bottom:12px;
object-fit:cover;
}

.btn{
margin-top:10px;height:52px;border:none;border-radius:12px;
width:100%;font-size:16px;font-weight:600;
}

.previewBtn{background:#0d6efd;color:#fff;}
.startBtn{background:#ff9800;color:#000;}

.captureBtn{
background:#198754;
color:#fff;
}
</style>
</head>

<body>

<div class="app">
<div id="routeBox"></div>
</div>

<script>

const CSV="https://docs.google.com/spreadsheets/d/e/2PACX-1vQ3bMMFf71-vdGNiWFnf7pD9XuAAUSA7J-g08ocyC2LNiVOTUHi56lB-7bKTKj0KK9nJGs9vU0THQ0E/pub?gid=1044390124&single=true&output=csv"

const HQ={lat:20.9964,lng:83.0526}

const tourPlan={
monday:["juria"],
tuesday:["ghess"],
wednesday:["gaisilate"],
thursday:["dava"],
friday:["padampur"],
saturday:["paikmal","mandosil"]
}

let customers=[]
const today=new Date().toLocaleDateString('en-US',{weekday:'long'}).toLowerCase()

function normalize(v){return (v||"").toLowerCase().trim()}

function parseCSV(text){
return text.split("\n").map(e=>e.split(","))
}

function getTodayParties(){
let areas=tourPlan[today]||[]
return customers.filter(c=>areas.includes(normalize(c.area)))
}

function buildGoogleMapsLink(route){
let waypoints=route.map(p=>`${p.lat},${p.lng}`).join("/")
return `https://www.google.com/maps/dir/${HQ.lat},${HQ.lng}/${waypoints}/${HQ.lat},${HQ.lng}`
}

function saveScreenshot(input){

const file=input.files[0]
if(!file) return

const reader=new FileReader()

reader.onload=function(){
localStorage.setItem("routeShot_"+today,reader.result)
render()
}

reader.readAsDataURL(file)
}

function removeShot(){
localStorage.removeItem("routeShot_"+today)
render()
}

function render(){

let todayRoute=getTodayParties()

let shot=localStorage.getItem("routeShot_"+today)

routeBox.innerHTML=`

<div class="routeCard">

<h3>ðŸ“… Todayâ€™s Route â€“ ${today.toUpperCase()}</h3>

${shot
? `
<img src="${shot}" class="mapPreview">

<button class="btn captureBtn" onclick="removeShot()">ðŸ”„ Retake Photo</button>
`
: `
<label class="btn captureBtn">
ðŸ“· Capture Route Screenshot
<input type="file" accept="image/*" capture="environment"
style="display:none"
onchange="saveScreenshot(this)">
</label>
`
}

<button class="btn previewBtn"
onclick="window.open('${buildGoogleMapsLink(todayRoute)}')">
ðŸ—º Preview Full Route
</button>

<button class="btn startBtn"
onclick="window.open('${buildGoogleMapsLink(todayRoute)}')">
ðŸ§­ Start Tour
</button>

</div>
`
}

function loadData(text){

let rows=parseCSV(text)
rows.shift()

customers=rows
.filter(r=>r[0])
.map(r=>({
name:r[0],
area:r[1],
lat:parseFloat(r[14]),
lng:parseFloat(r[15])
}))

render()
}

fetch(CSV).then(r=>r.text()).then(loadData)

</script>
</body>
</html>