<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aaradhya Field Recovery LIVE</title>

<style>
body{font-family:Arial;margin:0;background:#f4f6f9}
.header{background:#0d6efd;color:#fff;padding:14px;font-weight:600}
.box{background:#fff;margin:10px;padding:14px;border-radius:10px}
.btn{padding:12px;margin-top:8px;width:100%}
</style>
</head>

<body>

<div class="header">Field Recovery LIVE</div>

<div id="kpi" class="box">Loading KPI...</div>
<div id="tour" class="box"></div>
<div id="nextParty" class="box"></div>

<script>

const csvUrl="https://docs.google.com/spreadsheets/d/e/2PACX-1vQ3bMMFf71-vdGNiWFnf7pD9XuAAUSA7J-g08ocyC2LNiVOTUHi56lB-7bKTKj0KK9nJGs9vU0THQ0E/pub?gid=1044390124&single=true&output=csv"

const kpi=document.getElementById("kpi")
const tour=document.getElementById("tour")
const nextParty=document.getElementById("nextParty")

let customers=[]
let route=[]
let collected=0,visited=0,target=0

fetch(csvUrl)
.then(r=>r.text())
.then(text=>{

let rows=text.trim().split("\n").slice(1)

customers=rows.map(r=>{
let c=r.split(",")

return{
name:c[0],
due:parseFloat(c[6])||0,
phone:c[13],
lat:parseFloat(c[14]),
lng:parseFloat(c[15])
}
})

target=customers.reduce((s,c)=>s+c.due,0)*0.3

route=customers.filter(c=>c.lat && c.lng)

renderKPI()
loadNextParty()

})

.catch(()=>kpi.innerHTML="âŒ Run this using Live Server or Hosting")

function renderKPI(){
kpi.innerHTML=`
ğŸ¯ Target: â‚¹${target.toFixed(0)}<br>
ğŸ’° Collected: â‚¹${collected}<br>
ğŸ“‰ Balance: â‚¹${(target-collected).toFixed(0)}
`
}

function loadNextParty(){

if(route.length===0){
nextParty.innerHTML="<b>âœ… Day Completed</b>"
return
}

let p=route[0]

nextParty.innerHTML=`
<b>Next Party</b><br><br>
${p.name}<br>
â‚¹${p.due}

<button class="btn" onclick="navigate(${p.lat},${p.lng})">ğŸ“ Navigate</button>

<input type="number" id="amt" placeholder="Collection amount">

<button class="btn" onclick="saveCollection()">ğŸ’° Save Collection</button>
`
}

function navigate(lat,lng){
window.open(`https://www.google.com/maps?q=${lat},${lng}`)
}

function saveCollection(){

let amt=parseFloat(document.getElementById("amt").value)||0

collected+=amt
visited++

route.shift()

renderKPI()

tour.innerHTML=`Visited: ${visited}`

loadNextParty()
}

</script>

</body>
</html>
