<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aaradhya Today</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0d6efd">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
body{font-family:Poppins;margin:0;background:#f4f6f9}
.header{background:#0d6efd;color:#fff;padding:14px;font-weight:600}
.statusBar{padding:6px 14px;font-size:13px;background:#fff}
.routeBox{background:#fff;margin:10px;padding:14px;border-radius:14px;
display:grid;grid-template-columns:1fr 1fr;gap:14px;
box-shadow:0 2px 10px rgba(0,0,0,0.08)}
.leftBox{font-size:14px;line-height:1.8}
.partyList{max-height:170px;overflow:auto;font-size:13px}
.grid{padding:10px;display:grid;gap:12px}
.customer{background:#fff;padding:14px;border-radius:12px;
box-shadow:0 2px 6px rgba(0,0,0,0.08)}
.profileWrapper{background:#f4f6f9;min-height:100vh}
.profileHeader{background:linear-gradient(135deg,#2b6cb0,#1e4e8c);
color:#fff;padding:18px;font-size:18px;font-weight:600;display:flex;gap:10px}
.backBtn{background:#ffffff33;border:none;color:#fff;padding:6px 12px;border-radius:8px}
.profileCard{background:#fff;margin:15px;padding:18px;border-radius:18px;
box-shadow:0 6px 16px rgba(0,0,0,0.15)}
input,select{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #ccc}
.tour{background:#ff9800;margin-top:10px;width:100%;padding:12px;border:none;border-radius:8px;color:#fff}
</style>
</head>

<body>

<div class="header">Aaradhya Today</div>
<div id="dataStatus" class="statusBar"></div>

<div id="routeBox" class="routeBox"></div>
<div id="customerGrid" class="grid"></div>

<div id="profileScreen" style="display:none"></div>

<script>

const csvUrl="https://docs.google.com/spreadsheets/d/e/2PACX-1vQ3bMMFf71-vdGNiWFnf7pD9XuAAUSA7J-g08ocyC2LNiVOTUHi56lB-7bKTKj0KK9nJGs9vU0THQ0E/pub?gid=1044390124&single=true&output=csv"

let dataSource="loading"
let lastSync=localStorage.getItem("lastSync")||""

function updateStatus(msg){
document.getElementById("dataStatus").innerHTML=msg
}

updateStatus("ðŸ”„ Syncing latest data...")

fetch(csvUrl)
.then(res=>res.text())
.then(text=>{
dataSource="live"
lastSync=new Date().toLocaleTimeString()
localStorage.setItem("customerCSV",text)
localStorage.setItem("lastSync",lastSync)
updateStatus(`ðŸŸ¢ Live data â€¢ Updated ${lastSync}`)
loadData(text)
})
.catch(()=>{
let offlineData=localStorage.getItem("customerCSV")
if(offlineData){
dataSource="cache"
updateStatus(`ðŸŸ  Offline data â€¢ Last sync ${lastSync}`)
loadData(offlineData)
}else{
updateStatus("âŒ No data available")
}
})

setInterval(()=>{
fetch(csvUrl)
.then(res=>res.text())
.then(text=>{
localStorage.setItem("customerCSV",text)
lastSync=new Date().toLocaleTimeString()
localStorage.setItem("lastSync",lastSync)
updateStatus(`ðŸŸ¢ Live data â€¢ Updated ${lastSync}`)
loadData(text)
})
},120000)

let customers=[]

function parseCSV(text){
const rows=[];let row=[],value="",insideQuotes=false
for(let char of text){
if(char=='"'){insideQuotes=!insideQuotes;continue}
if(char==","&&!insideQuotes){row.push(value);value="";continue}
if((char=="\n"||char=="\r")&&!insideQuotes){
if(value||row.length){row.push(value);rows.push(row)}
row=[];value="";continue}
value+=char}
return rows
}

function loadData(text){
let rows=parseCSV(text).slice(1).filter(r=>r[0])
customers=rows.map(r=>({name:r[0],area:r[1],due:r[6]}))
renderList()
}

function renderList(){
customerGrid.innerHTML=""
customers.forEach(c=>{
customerGrid.innerHTML+=`
<div class="customer"><b>${c.name}</b><br>${c.area} | â‚¹${c.due}</div>`
})
}

</script>
</body>
</html>